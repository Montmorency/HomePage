      SUBROUTINE MMCAL(CRD,NDIM,NAT,NN,ND,NM,EV,IZP,NMAT,MM,VEC,IW)

      INTEGER*2 NN,MM,IZP,IW

      DIMENSION CRD(NDIM,NAT), NN(ND,20),MM(ND,20),IZP(NAT)

      DIMENSION VEC(NDIM,60), IW(2,60)

      LOGICAL EV

      NNMAT = 60

      IFD=NMAT

      IADD=1

      DO 1 II=1,NAT

      IF(IZP(II).LT.0)GOTO 2

1     CONTINUE

      IADD=0

      NNMAT=NMAT

      JL=NN(1,1)

      DO 13 JJ=2,JL

      J=NN(1,JJ)

      DO 11 I=1,NDIM

      VEC(I,NNMAT)=CRD(I,J)-CRD(I,1)

11    VEC(I,JJ-1)=VEC(I,NNMAT)

      MM(1,JJ)=JJ-1

      IW(1,JJ-1)=IZP(1)

13    IW(2,JJ-1)=IZP(J)

      IFD=JL-1

2     ISTRT=2-IADD

      DO 30 I=ISTRT,NAT

      IAZ=IZP(I)

      IAZ=IABS(IAZ)

      JL=NN(I,1)

      IF(JL.LT.2)GOTO 30

      DO 20 JJ=2,JL

      J=NN(I,JJ)

      IF(IADD.EQ.0)GOTO 3

      IF(IZP(I).GT.0.AND.IZP(J).GT.0)GOTO 20

3     JAZ=IZP(J)

      JAZ=IABS(JAZ)

      DO 14 K=1,NDIM

14    VEC(K,NNMAT)=CRD(K,J)-CRD(K,I)

      DO 16 L=1,IFD

      IF(IW(1,L).NE.IAZ)GOTO 16

      IF(IW(2,L).NE.JAZ)GOTO 16

      IF(EV(VEC(1,NNMAT),VEC(1,L)))GOTO 19

16    CONTINUE

      IFD=IFD+1

      IF(IFD.GE.NNMAT)GOTO 34

18    FORMAT(' TOO MANY DIFFERENT VECTORS - INCREASE NMAT')

      DO 29 M=1,NDIM

29    VEC(M,IFD)=VEC(M,NNMAT)

      IW(1,IFD)=IAZ

      IW(2,IFD)=JAZ

      L=IFD

19    MM(I,JJ)=L

20    CONTINUE

30    CONTINUE

      NMAT=IFD

      RETURN

34    WRITE(6,18)

      WRITE(6,41)I

41    FORMAT(26H HAMILTONIAN MAP AS FAR AS,I6,7HTH SITE)

      NMAT=0

      RETURN

      END
